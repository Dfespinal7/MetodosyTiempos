{% extends 'app/base.html' %}
{% load static %}

{% block titul %}Formulario Ficha{% endblock %}

{% block container %}

<div class="d-flex justify-content-center align-items-center mt-2">
    <div class="border p-4 rounded w-75">
        <h1>TIEMPOS PREDETERMINADOS</h1>
        <form action="{% url 'guardar_ficha' %}" method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <label for="usuario" class="form-label">Usuario</label><br>
                    <select name="usuario" id="usuario" class="form-control" required>
                        <option value="">Seleccione un Usuario</option>
                        {% for usuario in usuarios %}
                            <option value="{{usuario.idUsuario}}">{{usuario.nombre}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="fecha" class="form-label">Fecha</label>
                    <input type="date" id="fecha" class="form-control" name="fecha" required>
                </div>
                <div class="col-md-6">
                    <label for="operacion" class="form-label">Operación</label>
                    <select name="operacion" id="operacion" class="form-control" onchange="actcodOp()" required>
                        <option value="">Seleccione una operación</option>
                        {% for operacion in operaciones %}
                            <option value="{{operacion.codigo}}" data-cod="{{operacion.codigo}}">{{operacion.nombre}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="codigo_op" class="form-label">Código de Operación</label>
                    <input type="text" id="codigo_op" class="form-control" readonly name="cod_operacion">
                </div>
                <div class="col-md-6">
                    <label for="tipo_maquina" class="form-label">Tipo de Máquina</label>
                    <select name="tipo_maquina" id="tipo_maquina" class="form-control" onchange="actRPM()" required>
                        <option value="">Seleccione una máquina</option>
                        {% for maquina in maquinas %}
                            <option value="{{maquina.id}}" data-rpm="{{maquina.rpm}}" data-ppp="{{maquina.puntadas_por_min}}">{{maquina.nombre}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="rpm" class="form-label">RPM</label>
                    <input type="number" id="rpm" class="form-control" oninput="MTS()" readonly name="rpm" required>
                </div>
                <div class="col-md-6">
                    <label for="ppp" class="form-label">PPP</label>
                    <input type="text" id="ppp" class="form-control" oninput="MTS()" name="ppp" required>
                </div>
                <div class="col-md-6">
                    <label for="referencia" class="form-label">Referencia</label>
                    <input type="text" id="referencia" class="form-control" name="ref" required>
                </div>
                <div class="col-md-6">
                    <label for="modulo" class="form-label">Módulo</label>
                    <input type="text" id="modulo" class="form-control" name="modulo" required>
                </div>
                <div class="col-md-6">
                    <label for="min_turno" class="form-label">Minutos por Turno</label>
                    <select name="min_turno" id="min_turno" class="form-control" required>
                        <option value="">Seleccione Turno</option>
                        {% for turno in turnos %}
                            <option value="{{turno.id}}">{{turno.turno}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="suplementos" class="form-label">Suplementos</label>
                    <select name="suplementos" id="suplementos" class="form-control" required>
                        <option value="">Seleccione porcentaje</option>
                        {% for suplemento in suplementos %}
                            <option value="{{suplemento.id}}">{{suplemento.porcentaje}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <h1>TIEMPOS DE COSTURA</h1>
            <div class="row">
                <div class="col-md-6">
                    <label for="" class="form-label">Tipo de Tela</label>
                    <input type="text" class="form-control" name="tela" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">MST (Tiempo mínimo de Costura)</label>
                    <input type="number" class="form-control" id="resulmt" readonly name="mts" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">GTF (Factor de Guía y Tensión)</label>
                    <select name="gtf" id="gtff" class="form-control" required>
                        <option value="">Seleccione</option>
                        {% for gtf in gtfs %}
                            <option value="{{gtf.idGtf}}" data-gtf="{{gtf.valor}}">{{gtf.valor}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">LOS (Distancia de Costura)</label>
                    <input type="number" name="los" class="form-control" id="dista" oninput="arranque_parada()" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">N° DE PARADAS</label>
                    <input type="number" name="nparadas" class="form-control" id="nparadas" oninput="arranque_parada()" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">CONSTANTE (Valor 1 TMU)</label>
                    <input type="number" class="form-control" value="0.0006" readonly id="consta" name="consta" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">HSF (Factor de Alta Velocidad)</label>
                    <input type="number" class="form-control" id="fhsf" readonly name="hsf" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">SS (Parada de Arranque)</label>
                    <input type="number" class="form-control" id="parada_arranque" name="ss" required>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">P (Precisión de Parada)</label>
                    <select name="parad" id="parad" class="form-control" required>
                        <option value="">Seleccione</option>
                        {% for parada in paradas %}
                            <option value="{{parada.idParada}}" data-parada="{{parada.valor}}">{{parada.valor}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="" class="form-label">TMU COSTURA</label>
                    <input type="text" class="form-control" id="resultmu" name="tmu" required>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Crear</button>
        </form>
        <form action="">
            <h2>Formulario Dinámico</h2>
            <table id="movimientosTable" class="table table-hover">
                <thead>
                    <tr>
                        <th>N°</th>
                        <th>CODIGO</th>
                        <th>MOVIMIENTO</th>
                        <th>FRECUENCIA</th>
                        <th>DISTANCIA</th>
                        <th>TMU</th>
                        <th>TOTAL (TMU)</th>
                        <th>TIEMPO (SAM)</th>
                        <th>Acciones</th>
                    </tr>
                    <tr>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><input type="text"></td>
                        <td><button class="btn btn-outline-danger">Eliminar</button></td>
                    </tr>
                </thead>
                <tbody id="movimientosBody">
                    <!-- Filas dinámicas serán añadidas aquí -->
                </tbody>
            </table>
            <button type="button" class="btn btn-outline-primary">Añadir Fila</button>
        </form>
        <script src="{% static 'app/js/funciones.js' %}"></script>
    </div>
</div>

{% endblock %}
